name: CI

#on: [push]

# åœ¨masteråˆ†æ”¯å‘ç”Ÿpushäº‹ä»¶æ—¶è§¦å‘ã€‚
on:
  push:
    branches:
      - master

permissions:
  contents: write

env: # è®¾ç½®ç¯å¢ƒå˜é‡
  TZ: Asia/Shanghai # æ—¶åŒºï¼ˆè®¾ç½®æ—¶åŒºå¯ä½¿é¡µé¢ä¸­çš„`æœ€è¿‘æ›´æ–°æ—¶é—´`ä½¿ç”¨è¯¥æ—¶åŒºæ—¶é—´ï¼‰

jobs:
  build: # è‡ªå®šä¹‰åç§°
    runs-on: ubuntu-latest # è¿è¡Œåœ¨è™šæ‹Ÿæœºç¯å¢ƒubuntu-latest

    # strategy:
    #   matrix:
    #     node-version: [16.x]

    steps:
      - name: Checkout # æ­¥éª¤1
        uses: actions/checkout@v2 # ä½¿ç”¨çš„åŠ¨ä½œã€‚æ ¼å¼ï¼šuserName/repoNameã€‚ä½œç”¨ï¼šæ£€å‡ºä»“åº“ï¼Œè·å–æºç ã€‚ å®˜æ–¹actionsåº“ï¼šhttps://github.com/actions

      - name: Install and Build ğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: | #æ³¨æ„æˆ‘è¿™é‡Œæ˜¯ä½¿ç”¨çš„yarnç®¡ç†åŒ…ï¼Œå¦‚æœä½ ä½¿ç”¨çš„npmï¼Œè¯·æ¢æˆnpmçš„å‘½ä»¤ï¼šnpm installå’Œnpm run build
          npm install
          npm run build

      - name: Deploy
        uses: ImGrootZzw/codoc@master
        env:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          BRANCH: gh-pages # The branch the action should deploy to.
          FOLDER: docs/.vuepress/dist # The folder the action should deploy.
          CLEAN: true # Automatically remove deleted files from the deploy branch
      # - name: Use Node.js ${{ matrix.node-version }} # æ­¥éª¤2
      #   uses: actions/setup-node@v2 # ä½œç”¨ï¼šå®‰è£…nodejs
      #   with:
      #     node-version: ${{ matrix.node-version }} # ç‰ˆæœ¬

      # - name: Build-and-deploy # æ­¥éª¤3
      #   env: # è®¾ç½®ç¯å¢ƒå˜é‡
      #     GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }} # toKenç§å¯†å˜é‡
      #     # CODING_TOKEN: ${{ secrets.CODING_TOKEN }} # è…¾è®¯äº‘å¼€å‘è€…å¹³å°ï¼ˆcodingï¼‰ç§å¯†token
      #   run: |
      #     remote_addr=`git remote get-url --push origin`
      #     commit_info=`git describe --all --always --long`
      #     user_name=`git log -1 --pretty=format:'%an'`
      #     user_email=`git log -1 --pretty=format:'%ae'`
      #     deploy_branch=gh-pages
      #     yarn
      #     yarn build
      #     cd docs/.vuepress/dist
      #     git config --global init.defaultBranch $deploy_branch
      #     git init
      #     git config user.name ${user_name}
      #     git config user.email ${user_email}
      #     git add -A
      #     git commit -m "CI auto deploy, $commit_info"
      #     remote_addr1=`echo $remote_addr | awk -F'://' '{print $2}'`
      #     remote_addrPush=https://${user_name}:${GITHUB_TOKEN}@${remote_addr1}
      #     git remote add origin ${remote_addrPush}
      #     git push origin HEAD:$deploy_branch --force # æ¨é€åˆ°github $deploy_branchåˆ†æ”¯

      # åªæäº¤åˆ°github pagesä¹Ÿå¯ä»¥ä½¿ç”¨github-pages-deploy-actionï¼Œè¯¦è§: https://github.com/JamesIves/github-pages-deploy-action
