(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{406:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"一、创建shell脚本文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、创建shell脚本文件"}},[s._v("#")]),s._v(" 一、创建Shell脚本文件")]),s._v(" "),a("p",[s._v("进入到脚本文件夹，创建脚本文件"),a("code",[s._v("vim demoservice.sh")]),s._v("，")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("SERVICE_NAME")]),s._v("替换为想要监控的服务名")]),s._v(" "),a("li",[a("code",[s._v("LOG_DIR")]),s._v("替换脚本执行日志存放目录")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#!/bin/bash\n\n# 服务名称\nSERVICE_NAME="demoservice" \n\n# 脚本日志路径\nLOG_DIR="/service/logs/" \nLOG_FILE="${LOG_DIR}/$(date +%Y%m%d)/${SERVICE_NAME}.log"\nif [ ! -d "${LOG_DIR}/$(date +%Y%m%d)" ]; then\n    mkdir -p "${LOG_DIR}/$(date +%Y%m%d)"\nfi\n\n# 检查服务状态\nservice_status=$(systemctl is-active $SERVICE_NAME)\n\n# 如果服务不处于运行状态，则重启服务\nif [ "$service_status" != "active" ]; then\n    echo "$(date): Service $SERVICE_NAME is not running. Restarting..."  >> "$LOG_FILE"\n    systemctl restart $SERVICE_NAME\n    echo "$(date): Service $SERVICE_NAME restarted."  >> "$LOG_FILE"\nelse\n    echo "$(date): Service $SERVICE_NAME is running."  >> "$LOG_FILE"\nfi\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h1",{attrs:{id:"二、分配脚本权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、分配脚本权限"}},[s._v("#")]),s._v(" 二、分配脚本权限")]),s._v(" "),a("p",[s._v("执行"),a("code",[s._v("chmod +x demoservice.sh")]),s._v("，给予脚本执行权限")]),s._v(" "),a("h1",{attrs:{id:"三、创建定时任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、创建定时任务"}},[s._v("#")]),s._v(" 三、创建定时任务")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("crontab")]),s._v(" 命令设置一个定时任务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("crontab -e\n# 在打开的 crontab 文件中添加以下行：\n*/5 * * * * /service/demoservice.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("脚本将每隔 5 分钟检查 demoservice 服务状态并进行必要的重启操作")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"crontab-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crontab-命令"}},[s._v("#")]),s._v(" crontab 命令")]),s._v(" "),a("ul",[a("li",[s._v("crontab –e : 修改 crontab 文件. 如果文件不存在会自动创建。")]),s._v(" "),a("li",[s._v("crontab –l : 显示 crontab 文件。")]),s._v(" "),a("li",[s._v("crontab -r : 删除 crontab 文件。")]),s._v(" "),a("li",[s._v("crontab -ir : 删除 crontab 文件前提醒用户。")])]),s._v(" "),a("h2",{attrs:{id:"crontab-文件格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#crontab-文件格式"}},[s._v("#")]),s._v(" crontab 文件格式")]),s._v(" "),a("p",[s._v("{minute} {hour} {day-of-month} {month} {day-of-week} {full-path-to-shell-script}")]),s._v(" "),a("ul",[a("li",[s._v("minute: 区间为 0 – 59")]),s._v(" "),a("li",[s._v("hour: 区间为0 – 23")]),s._v(" "),a("li",[s._v("day-of-month: 区间为0 – 31")]),s._v(" "),a("li",[s._v("month: 区间为1 – 12. 1 是1月. 12是12月.")]),s._v(" "),a("li",[s._v("Day-of-week: 区间为0 – 7. 周日可以是0或7.")])]),s._v(" "),a("p",[s._v("Crontab 示例")]),s._v(" "),a("ol",[a("li",[s._v("在 12:01 a.m 运行，即每天凌晨过一分钟。这是一个恰当的进行备份的时间，因为此时系统负载不大。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1 0 * * * /root/bin/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("每个工作日(Mon – Fri) 11:59 p.m 都进行备份作业。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("59 11 * * 1,2,3,4,5 /root/bin/backup.sh\n\n# 下面例子与上面的例子效果一样：\n59 11 * * 1-5 /root/bin/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("每5分钟运行一次命令")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("*/5 * * * * /root/bin/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("每个月的第一天 1:10 p.m 运行")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("10 13 1 * * /root/bin/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("每个工作日 11 p.m 运行。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("0 23 * * 1-5 /root/bin/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);